{% extends "base.html" %}

{% block content %}
<div class="container mt-5">
    <h2 class="text-center mb-4">ğŸš— My Trips</h2>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ category }} shadow-sm rounded">{{ message }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <!-- Upcoming Trips -->
    <h4 class="mt-4 text-primary">âœ¨ Upcoming Trips</h4>
    {% if upcoming_bookings %}
        {% for booking in upcoming_bookings %}
        <div class="card mb-3 shadow-sm border-0 trip-card">
            <div class="card-body">
                <h5 class="card-title text-dark fw-bold">
                    {{ booking.ride.from_city }} â†’ {{ booking.ride.to_city }}
                </h5>
                <p class="card-text text-muted">
                    ğŸ“… Date: <strong>{{ booking.ride.date }}</strong> | ğŸ•’ Time: <strong>{{ booking.ride.time }}</strong> <br>
                    ğŸ‘¥ Seats Booked: <strong>{{ booking.seats_booked }}</strong> <br>
                    ğŸ’° Fare per Seat: <strong>â‚¹{{ booking.ride.fare_per_seat }}</strong> <br>
                    ğŸ‘¨â€âœˆï¸ Driver: {{ booking.ride.driver_username }} <br>
                    ğŸ“ Contact: {{ booking.ride.driver_phone }} <br>
                    ğŸš˜ Car No: {{ booking.ride.vehicle_number }} | Model: {{ booking.ride.vehicle_model }}
                </p>

                <!-- Ride Status Badge -->
                <span class="badge 
                    {% if booking.ride.status == 'Scheduled' %} bg-secondary
                    {% elif booking.ride.status == 'Started' %} bg-success
                    {% elif booking.ride.status == 'Ended' %} bg-dark
                    {% endif %} px-3 py-2 me-2">
                    {{ booking.ride.status }}
                </span>

                <!-- Booking Status Badge -->
                <span class="badge 
                    {% if booking.status == 'approved' %} bg-success 
                    {% elif booking.status == 'pending' %} bg-warning text-dark 
                    {% elif booking.status == 'rejected' %} bg-danger 
                    {% endif %} px-3 py-2">
                    {{ booking.status|capitalize }}
                </span>

                <!-- Cancel Booking (only if not rejected & ride still Scheduled) -->
                {% if booking.status != "rejected" and booking.ride.status == "Scheduled" %}
                <form method="POST" action="{{ url_for('cancel_booking', booking_id=booking.id) }}" class="mt-2">
                    <button type="submit" class="btn btn-danger btn-sm">Cancel Booking</button>
                </form>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    {% else %}
        <p class="text-muted fst-italic">No upcoming trips booked yet.</p>
    {% endif %}

    <!-- Past Trips -->
    <h4 class="mt-5 text-secondary">ğŸ•“ Past Trips</h4>
    {% if past_bookings %}
        {% for booking in past_bookings %}
        <div class="card mb-3 shadow-sm border-0 trip-card">
            <div class="card-body">
                <h5 class="card-title text-dark fw-bold">
                    {{ booking.ride.from_city }} â†’ {{ booking.ride.to_city }}
                </h5>
                <p class="card-text text-muted">
                    ğŸ“… Date: <strong>{{ booking.ride.date }}</strong> | ğŸ•’ Time: <strong>{{ booking.ride.time }}</strong> <br>
                    ğŸ‘¥ Seats Booked: <strong>{{ booking.seats_booked }}</strong> <br>
                    ğŸ’° Fare per Seat: <strong>â‚¹{{ booking.ride.fare_per_seat }}</strong> <br>
                    ğŸ‘¨â€âœˆï¸ Driver: {{ booking.ride.driver_username }} <br>
                    ğŸ“ Contact: {{ booking.ride.driver_phone }} <br>
                    ğŸš˜ Car No: {{ booking.ride.vehicle_number }} | Model: {{ booking.ride.vehicle_model }}
                </p>
                <span class="badge bg-dark px-3 py-2">Ended</span>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <p class="text-muted fst-italic">No past trips found.</p>
    {% endif %}
</div>

<!-- Extra Styling -->
<style>
    .trip-card:hover {
        transform: translateY(-3px);
        transition: 0.3s;
        box-shadow: 0 6px 18px rgba(0,0,0,0.1);
    }
</style>
{% endblock %}
